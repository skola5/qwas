<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Pixel Adventure Game</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #111;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        header {
            width: 100%;
            background: #222;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        nav {
            margin: 10px 0;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
        }
        nav a:hover {
            color: #ff0;
        }
        #gameContainer {
            position: relative;
            margin: 20px 0;
        }
        canvas {
            border: 2px solid #fff;
            background: #000;
            image-rendering: pixelated;
            max-width: 100%;
            touch-action: none; /* Prevent touch scrolling issues */
        }
        #scoreBoard {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 16px;
        }
        #levelIndicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 16px;
        }
        #instructions {
            max-width: 800px;
            margin: 20px;
            text-align: center;
        }
        #highScores {
            max-width: 800px;
            margin: 20px;
            text-align: center;
        }
        footer {
            width: 100%;
            background: #222;
            padding: 10px;
            text-align: center;
            margin-top: auto;
        }
        @media (max-width: 600px) {
            canvas {
                width: 100%;
                height: auto;
            }
            #scoreBoard, #levelIndicator {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Enhanced Pixel Adventure</h1>
        <nav>
            <a href="#game">Play Game</a>
            <a href="#instructions">Instructions</a>
            <a href="#highScores">High Scores</a>
            <a href="#about">About</a>
        </nav>
    </header>

    <section id="game">
        <div id="gameContainer">
            <canvas id="gameCanvas" width="640" height="480"></canvas>
            <div id="scoreBoard">Score: 0 | Lives: 3</div>
            <div id="levelIndicator">Level: 1</div>
        </div>
    </section>

    <section id="instructions">
        <h2>Instructions</h2>
        <p>Use arrow keys to move left/right, up/down for climbing (if added in future), and Space to jump. Collect coins (yellow) for points, avoid enemies (blue), reach the goal (cyan) to advance levels.</p>
        <p>Features: Multi-level progression, improved physics, enemy AI, high scores (stored locally), sound effects, and prevented page scrolling on Space key.</p>
        <p>For mobile: Use on-screen buttons (added below canvas for touch devices).</p>
    </section>

    <section id="highScores">
        <h2>High Scores</h2>
        <ul id="highScoreList">
            <!-- Populated by JS -->
        </ul>
    </section>

    <section id="about">
        <h2>About</h2>
        <p>This enhanced pixel game includes better collision detection, multiple levels, local storage for high scores, simple sound effects via Web Audio API, and touch controls for mobile. Built in pure HTML5/JS, no externals. Hosted on GitHub Pages.</p>
    </section>

    <footer>
        <p>&copy; 2025 Pixel Games. All rights reserved. | <a href="#top" style="color: #fff;">Back to Top</a></p>
    </footer>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const pixelSize = 10;
        const gravity = 0.5;
        const jumpPower = -10;
        const maxLevels = 3;

        // Player
        let player = {
            x: 5,
            y: 40,
            vx: 0,
            vy: 0,
            width: 1,
            height: 1,
            onGround: false,
            lives: 3
        };

        // Game state
        let score = 0;
        let level = 1;
        let keys = {};
        let gameOver = false;
        let highScores = JSON.parse(localStorage.getItem('highScores')) || [];
        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // Level data
        function getLevelData(lvl) {
            let platforms, enemies, coins, goal;
            if (lvl === 1) {
                platforms = [
                    { x: 0, y: 47, width: 64, height: 1 }, // Floor
                    { x: 0, y: 0, width: 64, height: 1 }, // Ceiling
                    { x: 0, y: 0, width: 1, height: 48 }, // Left wall
                    { x: 63, y: 0, width: 1, height: 48 }, // Right wall
                    { x: 15, y: 35, width: 10, height: 1 },
                    { x: 30, y: 25, width: 10, height: 1 },
                    { x: 45, y: 40, width: 10, height: 1 }
                ];
                enemies = [
                    { x: 20, y: 40, vx: 0.5, minX: 15, maxX: 25 },
                    { x: 40, y: 40, vx: -0.5, minX: 35, maxX: 45 }
                ];
                coins = [
                    { x: 10, y: 30 }, { x: 25, y: 20 }, { x: 50, y: 35 },
                    { x: 32, y: 24 }, { x: 47, y: 39 }
                ];
                goal = { x: 60, y: 40 };
            } else if (lvl === 2) {
                platforms = [
                    { x: 0, y: 47, width: 64, height: 1 },
                    { x: 0, y: 0, width: 64, height: 1 },
                    { x: 0, y: 0, width: 1, height: 48 },
                    { x: 63, y: 0, width: 1, height: 48 },
                    { x: 5, y: 40, width: 8, height: 1 },
                    { x: 20, y: 30, width: 10, height: 1 },
                    { x: 35, y: 20, width: 12, height: 1 },
                    { x: 50, y: 35, width: 8, height: 1 }
                ];
                enemies = [
                    { x: 10, y: 39, vx: 0.7, minX: 5, maxX: 13 },
                    { x: 25, y: 29, vx: -0.7, minX: 20, maxX: 30 },
                    { x: 40, y: 19, vx: 0.7, minX: 35, maxX: 47 }
                ];
                coins = [
                    { x: 6, y: 39 }, { x: 22, y: 29 }, { x: 37, y: 19 },
                    { x: 52, y: 34 }, { x: 12, y: 25 }, { x: 42, y: 15 }
                ];
                goal = { x: 58, y: 34 };
            } else if (lvl === 3) {
                platforms = [
                    { x: 0, y: 47, width: 64, height: 1 },
                    { x: 0, y: 0, width: 64, height: 1 },
                    { x: 0, y: 0, width: 1, height: 48 },
                    { x: 63, y: 0, width: 1, height: 48 },
                    { x: 8, y: 42, width: 6, height: 1 },
                    { x: 18, y: 35, width: 8, height: 1 },
                    { x: 30, y: 28, width: 10, height: 1 },
                    { x: 42, y: 38, width: 7, height: 1 },
                    { x: 52, y: 25, width: 9, height: 1 }
                ];
                enemies = [
                    { x: 10, y: 41, vx: 1, minX: 8, maxX: 14 },
                    { x: 20, y: 34, vx: -1, minX: 18, maxX: 26 },
                    { x: 32, y: 27, vx: 1, minX: 30, maxX: 40 },
                    { x: 44, y: 37, vx: -1, minX: 42, maxX: 49 }
                ];
                coins = [
                    { x: 9, y: 41 }, { x: 19, y: 34 }, { x: 31, y: 27 },
                    { x: 43, y: 37 }, { x: 53, y: 24 }, { x: 25, y: 20 },
                    { x: 48, y: 15 }, { x: 15, y: 30 }
                ];
                goal = { x: 60, y: 24 };
            }
            return { platforms, enemies, coins, goal };
        }

        let { platforms, enemies, coins, goal } = getLevelData(level);

        function playSound(frequency, duration) {
            let oscillator = audioCtx.createOscillator();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start();
            setTimeout(() => oscillator.stop(), duration);
        }

        function drawPixel(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(Math.floor(x) * pixelSize, Math.floor(y) * pixelSize, pixelSize, pixelSize);
        }

        function drawRect(x, y, w, h, color) {
            ctx.fillStyle = color;
            ctx.fillRect(Math.floor(x) * pixelSize, Math.floor(y) * pixelSize, w * pixelSize, h * pixelSize);
        }

        function drawMap() {
            platforms.forEach(p => drawRect(p.x, p.y, p.width, p.height, '#00ff00'));
        }

        function drawPlayer() {
            drawPixel(player.x, player.y, '#ff0000');
        }

        function drawEnemies() {
            enemies.forEach(e => drawPixel(e.x, e.y, '#0000ff'));
        }

        function drawCoins() {
            coins.forEach(c => drawPixel(c.x, c.y, '#ffff00'));
        }

        function drawGoal() {
            drawPixel(goal.x, goal.y, '#00ffff');
        }

        function updatePlayer() {
            player.vy += gravity;
            player.x += player.vx;
            player.y += player.vy;

            player.onGround = false;
            platforms.forEach(p => {
                const overlapX = player.x + player.width > p.x && player.x < p.x + p.width;
                const overlapY = player.y + player.height > p.y && player.y < p.y + p.height;
                if (overlapX && overlapY) {
                    const prevY = player.y - player.vy;
                    const prevX = player.x - player.vx;
                    if (player.vy > 0 && prevY + player.height <= p.y) {
                        player.y = p.y - player.height;
                        player.vy = 0;
                        player.onGround = true;
                    } else if (player.vy < 0 && prevY >= p.y + p.height) {
                        player.y = p.y + p.height;
                        player.vy = 0;
                    } else if (player.vx > 0 && prevX + player.width <= p.x) {
                        player.x = p.x - player.width;
                        player.vx = 0;
                    } else if (player.vx < 0 && prevX >= p.x + p.width) {
                        player.x = p.x + p.width;
                        player.vx = 0;
                    }
                }
            });

            // Controls
            player.vx *= 0.8; // Friction
            if (keys['ArrowLeft']) player.vx = -1.5;
            if (keys['ArrowRight']) player.vx = 1.5;
            if (keys[' '] && player.onGround) {
                player.vy = jumpPower;
                player.onGround = false;
                playSound(440, 100); // Jump sound
            }

            // Boundaries
            if (player.x < 1) player.x = 1;
            if (player.x > 62) player.x = 62;
            if (player.y < 1) player.y = 1;
            if (player.y > 46) {
                player.y = 46;
                player.vy = 0;
                player.onGround = true;
            }
        }

        function updateEnemies() {
            enemies.forEach(e => {
                e.x += e.vx;
                if (e.x <= e.minX || e.x >= e.maxX) e.vx = -e.vx;
            });
        }

        function checkCollisions() {
            // Coins
            coins = coins.filter(c => {
                if (Math.abs(player.x - c.x) < 1 && Math.abs(player.y - c.y) < 1) {
                    score += 10 * level;
                    playSound(880, 50); // Coin sound
                    return false;
                }
                return true;
            });

            // Enemies
            enemies.forEach(e => {
                if (Math.abs(player.x - e.x) < 1 && Math.abs(player.y - e.y) < 1) {
                    player.lives--;
                    playSound(220, 200); // Hit sound
                    player.x = 5;
                    player.y = 40;
                    if (player.lives <= 0) {
                        gameOver = true;
                        updateHighScores();
                    }
                }
            });

            // Goal
            if (Math.abs(player.x - goal.x) < 1 && Math.abs(player.y - goal.y) < 1) {
                playSound(660, 100); // Win sound
                level++;
                if (level > maxLevels) {
                    alert('You Completed All Levels! Final Score: ' + score);
                    resetGame(true);
                } else {
                    alert('Level Complete! Score: ' + score);
                    resetLevel();
                }
            }
        }

        function updateScoreBoard() {
            document.getElementById('scoreBoard').innerText = `Score: ${score} | Lives: ${player.lives}`;
            document.getElementById('levelIndicator').innerText = `Level: ${level}`;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawMap();
            drawCoins();
            drawEnemies();
            drawPlayer();
            drawGoal();
        }

        function gameLoop() {
            if (!gameOver) {
                updatePlayer();
                updateEnemies();
                checkCollisions();
                draw();
                updateScoreBoard();
            } else {
                ctx.fillStyle = '#fff';
                ctx.font = '30px Arial';
                ctx.fillText('Game Over! Score: ' + score, canvas.width / 2 - 150, canvas.height / 2);
            }
            requestAnimationFrame(gameLoop);
        }

        function resetLevel() {
            player.x = 5;
            player.y = 40;
            player.vx = 0;
            player.vy = 0;
            ({ platforms, enemies, coins, goal } = getLevelData(level));
        }

        function resetGame(fullReset = false) {
            if (fullReset) {
                level = 1;
                score = 0;
                player.lives = 3;
            }
            resetLevel();
            gameOver = false;
        }

        function updateHighScores() {
            highScores.push(score);
            highScores.sort((a, b) => b - a);
            highScores = highScores.slice(0, 5);
            localStorage.setItem('highScores', JSON.stringify(highScores));
            displayHighScores();
        }

        function displayHighScores() {
            const list = document.getElementById('highScoreList');
            list.innerHTML = '';
            highScores.forEach((s, i) => {
                const li = document.createElement('li');
                li.textContent = `#${i+1}: ${s}`;
                list.appendChild(li);
            });
        }

        // Event listeners
        document.addEventListener('keydown', e => {
            keys[e.key] = true;
            if (e.key === ' ') {
                e.preventDefault(); // Prevent page scroll on space
            }
        });
        document.addEventListener('keyup', e => keys[e.key] = false);

        // Touch controls for mobile
        if ('ontouchstart' in window) {
            const leftBtn = document.createElement('button');
            leftBtn.textContent = '←';
            leftBtn.style.position = 'fixed';
            leftBtn.style.bottom = '20px';
            leftBtn.style.left = '20px';
            leftBtn.style.padding = '20px';
            leftBtn.addEventListener('touchstart', () => keys['ArrowLeft'] = true);
            leftBtn.addEventListener('touchend', () => keys['ArrowLeft'] = false);

            const rightBtn = document.createElement('button');
            rightBtn.textContent = '→';
            rightBtn.style.position = 'fixed';
            rightBtn.style.bottom = '20px';
            rightBtn.style.left = '100px';
            rightBtn.style.padding = '20px';
            rightBtn.addEventListener('touchstart', () => keys['ArrowRight'] = true);
            rightBtn.addEventListener('touchend', () => keys['ArrowRight'] = false);

            const jumpBtn = document.createElement('button');
            jumpBtn.textContent = 'Jump';
            jumpBtn.style.position = 'fixed';
            jumpBtn.style.bottom = '20px';
            jumpBtn.style.right = '20px';
            jumpBtn.style.padding = '20px';
            jumpBtn.addEventListener('touchstart', e => {
                e.preventDefault();
                if (player.onGround) {
                    player.vy = jumpPower;
                    player.onGround = false;
                    playSound(440, 100);
                }
            });

            document.body.appendChild(leftBtn);
            document.body.appendChild(rightBtn);
            document.body.appendChild(jumpBtn);
        }

        displayHighScores();
        gameLoop();
    </script>
</body>
</html>
